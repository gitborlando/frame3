var s={element:"element",textNode:"textNode",fragment:"fragment",component:"component"};var u={string:e=>Object.prototype.toString.call(e)==="[object String]",number:e=>Object.prototype.toString.call(e)==="[object Number]",boolean:e=>Object.prototype.toString.call(e)==="[object Boolean]",undefined:e=>Object.prototype.toString.call(e)==="[object Undefined]",null:e=>Object.prototype.toString.call(e)==="[object Null]",function:e=>Object.prototype.toString.call(e)==="[object Function]",object:e=>Object.prototype.toString.call(e)==="[object Object]",array:e=>Object.prototype.toString.call(e)==="[object Array]",multi(e,n){return n.split("|").some(t=>this[t.trim()]?.(e))}},i={component:e=>e?.type===s.component,fragment:e=>e?.type===s.fragment,element:e=>e?.type===s.element,textNode:e=>e?.type===s.textNode};var y=new Set,J=Promise.resolve(),P="Leaved a Tick",L=null;function A(e){y.has(e)||(y.add(e),q())}function q(){P!=="Entered a Tick"&&(L=J.then(Q),P="Entered a Tick")}function Q(){try{y.forEach(e=>e())}finally{P="Leaved a Tick",y.clear(),L=null}}function N(e){return function n(t){return new Proxy(t,{get(r,o){w(r,o);let c=Reflect.get(r,o);return typeof c=="object"?n(c):c},set(r,o,c){return Reflect.set(r,o,c),R(r,o),R(r,V),!0}})}({value:e})}function k(e){return e}var p,g=[],h=new WeakMap;function w(e,n){if(!p)return;if(u.array(e)){if(n==="length")return;n=n===V?n:"length"}h.get(e)||h.set(e,new Map);let t=h.get(e);t?.get(n)||t.set(n,new Set),p.shouldTrack&&t.get(n).add(p)}var V=Symbol("manual-track-object-key");function W(e){return w(e,V),e}function R(e,n){if(!e.hasOwnProperty(n)||n==="length")return;if(u.array(e)){if(n==="length")return;n=n===V?n:"length"}h.get(e)?.get(n)?.forEach(o=>{o!==p&&(o.scheduler?o.scheduler(o):o())})}function b(e,n){let t=Object.assign(()=>{try{g.push(p=t);let r=g.slice(-2,-1)[0];if(r&&!r.isFirstRun){p.shouldTrack=!1;return}e(n),p.isFirstRun=!1}finally{g.pop(),p=g.slice(-1)[0]}},{isFirstRun:!0,shouldTrack:!0,scheduler:n?.scheduler||A});t()}function z(e){let n=N("");return b(()=>n.value=e()),n}function G(e){return N()}function X(e){return k()}function F(e){let{jsxTag:n,props:t,children:r}=e,o=e.componentInstance={isMounted:!1,props:{...t,children:r}},c=n(o.props);o.update=()=>{let a=c();a.children=E(a.children),o.isMounted?m(o.subVnode,a):(d(a),o.isMounted=!0),o.subVnode=a,e.el=a.el},o.passiveUpdate=(a,l)=>{o.props={...a,children:l},c=n(o.props),o.update()},t.hasOwnProperty("ref")&&(t.ref.value=o),b(o.update)}function K(e,n){n.componentInstance=e.componentInstance,!Y(e.props,n.props)&&n.componentInstance.passiveUpdate(n.props,n.children)}function Y(e,n){return Object.keys(n).every(t=>e[t]===n[t])}function I(e){j?.insertBefore(e,v)}function $(e,n=j){n&&(n.textContent=e)}function C(e){e?.remove()}var j,v;function M(){return{currentParentEl:j,currentAnchorEl:v}}function f({currentParentEl:e,currentAnchorEl:n}){let{currentParentEl:t,currentAnchorEl:r}=M();return e&&(j=e),v=n||null,function(){f({currentParentEl:t,currentAnchorEl:r})}}function S(e,n,t){let r=e?e.props:{},o=n.props,c=Object.entries(o).map(([a,l])=>a in r?r[a]!==l?[a,l]:void 0:[a,l]).filter(Boolean);for(let[a,l]of c)if(a.startsWith("on"))t.addEventListener(a.slice(2).toLocaleLowerCase(),l);else if(a==="style"){let H=Object.entries(l).map(([U,D])=>`${U}: ${D}`).join(";");t.setAttribute("style",H)}else a==="ref"?l.value=t:a==="className"?t.className=l:a==="scope-id"?t.setAttribute(`scope-${l}`,""):t.setAttribute(a,l)}function O(e,n){e.children[0]?.key&&n.children[0]?.key?_(e.children,n.children):Z(e.children,n.children)}function Z(e,n){let t=e.length,r=n.length,o=Math.min(t,r);for(let c=0;c<o;c++)m(e[c],n[c]);if(r>t)return n.slice(o).forEach(c=>d(c));if(t>r)return e.slice(o).forEach(c=>x(c))}function _(e,n){let t=0,r=e.length-1,o=n.length-1;for(;t<=r&&t<=o&&B(e[t],n[t]);)m(e[t],n[t]),t++;for(;t<=r&&t<=o&&B(e[r],n[o]);)m(e[t],n[t]),r--,o--;if(t>r)for(let c=t;c<=o;c++)d(n[c]);if(t>o)for(let c=t;c<=o;c++)x(e[c])}function B(e,n){return e.type===n.type&&e.key===n.key}function T(e,n={},t=[]){let r={props:n,children:t,el:null,key:n.key};return e===0?{type:s.textNode,jsxTag:e,...r}:u.function(e)?{type:s.component,jsxTag:e,componentInstance:null,...r}:(r.children=E(r.children),u.array(e)?{type:s.fragment,jsxTag:e,anchor:null,...r}:{type:s.element,jsxTag:e,...r})}function E(e){let n=[];return e.forEach(t=>{if(u.multi(t,"string|number"))return n.push(T(0,{},[t]));if(u.multi(t,"undefined|null"))return n.push(T(0,{},[""]));if(u.array(t))return n.push(T([],{},E(t)));n.push(t)}),n}function d(e){if(i.component(e))return F(e);if(i.fragment(e))return ee(e);if(i.element(e))return oe(e);if(i.textNode(e))return ce(e)}function m(e,n){if(i.component(n)&&i.component(e))return K(e,n);if(i.fragment(n)&&i.fragment(e))return ne(e,n);if(i.element(n)&&i.element(e))return re(e,n);if(i.textNode(n)&&i.textNode(e))return ae(e,n);x(e),d(n)}function x(e){return i.component(e)&&e.componentInstance?x(e.componentInstance.subVnode):i.fragment(e)?te(e):C(e.el)}function ee(e){let n=e.el=document.createTextNode("s"),t=e.anchor=document.createTextNode("e");I(n),I(t);let{currentParentEl:r}=M();for(let o of e.children)f({currentAnchorEl:t,currentParentEl:r}),d(o)}function ne(e,n){let t=(n.el=e.el)?.parentElement,r=n.anchor=e.anchor,o=f({currentAnchorEl:r,currentParentEl:t});O(e,n),o()}function te(e){let{el:n,anchor:t}=e;for(;n!==t;){let r=n?.nextSibling;C(n),n=r}C(t)}function oe(e){let n=document.createElement(e.jsxTag);S(null,e,n),I(e.el=n);for(let t of e.children)f({currentParentEl:n}),d(t)}function re(e,n){let t=n.el=e.el;if(!t)return;S(e,n,t);let r=f({currentParentEl:t});O(e,n),r()}function ce(e){let n=document.createTextNode(e.children[0].toString());I(e.el=n)}function ae(e,n){let t=n.el=e.el,r=e.children[0].toString(),o=n.children[0].toString();o!==r&&$(o,t||void 0)}function ie(e,n){f({currentParentEl:n}),F(T(e,{},[]))}export{k as $reactive,X as $ref,z as computed,b as effect,T as h,W as manualTrack,ie as mount,N as reactive,G as ref};
